<h3 nz-typography>Kanban</h3>

<div class="options-bar">
  <div class="inputs-bar">
    <nz-input-group
      style="
        margin-bottom: 16px;
        margin-right: 10px;
        width: 25vw;
        border-radius: 3px;
        outline: none;
        width: 50%;
      "
    >
      <nz-form-control>
        <nz-col nzXs="12" nzSm="24">
          <nz-select
            nzAllowClear
            nzPlaceHolder="Select a kanban board"
            formControlName="use_type"
          >
            <ng-container *ngFor="let board of boardsList">
              <nz-option
                [nzValue]="board.board_id"
                [nzLabel]="board.board_title"
              ></nz-option>
            </ng-container>
          </nz-select>
        </nz-col>
      </nz-form-control>
    </nz-input-group>
    <nz-input-group style="width: 50%">
      <input
        type="text"
        nz-input
        placeholder="Filter card items"
        [(ngModel)]="searchText"
        (ngModelChange)="filterData(searchText)"
      />
    </nz-input-group>
  </div>
  <div class="buttons-bar">
    <button
      nz-button
      nzType="primary"
      nzShape="circle"
      style="margin-right: 10px"
    >
      <span nz-icon nzType="share-alt"></span>
    </button>
    <button nz-button nzType="primary" nzShape="circle" (click)="createBoard()">
      <span nz-icon nzType="plus"></span>
    </button>
  </div>
</div>

<div
  cdkDropListGroup
  cdkDropList
  [cdkDropListData]="board"
  (cdkDropListDropped)="dropBoard($event)"
>
  <div class="example-container" style="display: flex; overflow-x: scroll">
    <nz-col
      cdkDrag
      *ngFor="let column of board"
      [nzSpan]="8"
      style="width: 200px; margin-right: 20px"
    >
      <div style="display: flex; justify-content: space-between">
        <h4 style="cursor: grab" nz-typography>{{ column.title }}</h4>

        <nz-space>
          <button
            *nzSpaceItem
            nz-button
            nzNoAnimation
            nz-dropdown
            [nzDropdownMenu]="menu"
            nzPlacement="bottomRight"
            style="border: none; padding: 0"
          >
            <span
              nz-icon
              nzType="more"
              nzTheme="outline"
              style="font-size: 20px; vertical-align: top"
            ></span>
          </button>
        </nz-space>
        <nz-dropdown-menu #menu="nzDropdownMenu">
          <ul nz-menu>
            <li
              nz-menu-item
              nz-popover
              nzPopoverTitle="Are you sure?"
              (nzPopoverVisibleChange)="change($event)"
              nzPopoverTrigger="click"
              [nzPopoverContent]="contentTemplate"
            >
              Delete
            </li>
            <li nz-menu-item>Edit</li>
          </ul>

          <ng-template #contentTemplate>
            <a (click)="deleteBoard(column.id)">Yes</a>
            <a (click)="close()">No</a>
          </ng-template>
        </nz-dropdown-menu>
      </div>

      <div
        cdkDropList
        [cdkDropListData]="column.cards"
        class="example-list"
        (cdkDropListDropped)="drop($event, column)"
        (click)="setNewCard(column)"
        style="
          background-color: #f4f4f4;
          height: 45vh;
          overflow-y: scroll;
          border-radius: 9px;
        "
      >
        <div
          class="example-box"
          *ngFor="let card of column.cards"
          cdkDrag
          style="
            background-color: white;
            padding: 5px;
            border-radius: 7px;
            margin: 7px;
            cursor: grab;
          "
          (contextmenu)="onRightClick($event, card)"
        >
          <p
            style="
              font-size: 12px;
              white-space: pre-wrap;
              word-wrap: break-word;
              overflow-wrap: break-word;
              max-width: 100%;
            "
          >
            {{ card.title }}
          </p>
          <p style="font-size: 10px; display: flex; justify-content: flex-end">
            {{ card.use_name }} - {{ card.card_datins }}
          </p>
        </div>
        <div *ngIf="showCardInput && selectedColumn.id === column.id">
          <input
            #cardInput
            style="margin: 7px; border: none; border-radius: 5px"
            type="text"
            placeholder="Enter card title"
            [(ngModel)]="newCardTitle"
            (keyup.enter)="insertCard(column)"
          />
        </div>
      </div>
    </nz-col>
    <nz-col [nzSpan]="8" style="height: 48.5vh; width: 200px">
      <h4 nz-typography></h4>
      <div
        style="
          background-color: #f4f4f4;
          height: 48vh;
          width: 190px;
          border-radius: 15px;
          display: flex;
          justify-content: center;
          align-items: center;
        "
      >
        <div style="display: inline">
          <p (click)="showInput()">Add new board</p>
          <div *ngIf="showInputBox">
            <input
              type="text"
              #inputBox
              style="margin: 7px; border: none; border-radius: 5px"
              placeholder="Enter board title"
              (keyup.enter)="addBoard(inputBox.value)"
            />
          </div>
        </div>
      </div>
    </nz-col>
  </div>
</div>
